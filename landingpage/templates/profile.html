{% extends 'base.html' %}
{% load static %}

{% block title %}Profile - Xcore{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">
<style>
  /* FORCE OVERRIDE */
  .profile-page {
    width: 100% !important;
    padding-top: 120px !important;
    margin-top: 0 !important;
    padding-bottom: 120px !important;
  }
  .profile-container {
    margin-top: 0 !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="profile-page">
  <div class="profile-container">


    <div class="profile-info">
      <h2 class="profile-username">{{ user.username }}</h2>
      <p class="profile-email">{{ user.email }}</p>

      {% if user.bio %}
        <div class="profile-field">
          <label>Bio</label>
          <div class="profile-field-box">{{ user.bio }}</div>
        </div>
      {% else %}
        <div class="profile-field">
          <label>Bio</label>
          <div class="profile-field-box empty">No bio yet. Add one below!</div>
        </div>
      {% endif %}

      <form method="POST" enctype="multipart/form-data" class="profile-form" id="profile-form" style="display:none;">
        {% csrf_token %}
        <div class="form-group">
          <label class="form-label">Username</label>
          <input type="text" name="username" value="{{ user.username }}" required>
        </div>

        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" name="email" value="{{ user.email }}" required>
        </div>

        <div class="form-group">
          <label class="form-label">Bio</label>
          <textarea name="bio" rows="4">{{ user.bio }}</textarea>
        </div>

        <input type="file" name="profile_picture" id="file-input" accept="image/*" style="display:none;" onchange="previewImage(event)">

        <button type="submit" class="update-button">üíæ Save Changes</button>
        <button type="button" class="cancel-button" id="cancel-btn">Cancel</button>
      </form>

      <div class="edit-profile-container" id="edit-container">
        <button class="edit-profile-button" id="edit-btn">‚úèÔ∏è Edit Profile</button>
      </div>
    </div>

    <div class="profile-picture-container">
    <label for="file-input" class="profile-picture-label">
        {% if user.profile_picture %}
        <img src="{{ user.profile_picture.url }}" alt="Profile Picture" class="profile-picture" id="preview">
        {% else %}
        <img src="{% static 'image/default_pp.jpg' %}" alt="Default Profile Picture" class="profile-picture" id="preview">
        {% endif %}
        <div class="hover-text">Change Picture</div>
    </label>
    </div>


  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function previewImage(event) {
  const reader = new FileReader();
  reader.onload = function(){
    document.getElementById('preview').src = reader.result;
  };
  reader.readAsDataURL(event.target.files[0]);
}

document.addEventListener('DOMContentLoaded', () => {
  const editBtn = document.getElementById('edit-btn');
  const cancelBtn = document.getElementById('cancel-btn');
  const form = document.getElementById('profile-form');
  const editContainer = document.getElementById('edit-container');
  const fileInput = document.getElementById('file-input');

  // Disable profile picture click until Edit Profile is pressed
  const pictureLabel = document.querySelector('.profile-picture-label');
  pictureLabel.classList.add('disabled');

  editBtn.addEventListener('click', () => {
    form.style.display = 'block';
    editContainer.style.display = 'none';
    pictureLabel.classList.remove('disabled');
  });

  cancelBtn.addEventListener('click', () => {
    form.style.display = 'none';
    editContainer.style.display = 'block';
    pictureLabel.classList.add('disabled');
  });
});
</script>
{% endblock %}
